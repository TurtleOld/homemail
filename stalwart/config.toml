# Конфигурация Stalwart Mail Server для Docker
# Работает по HTTP (порт 8080) без TLS

[server]
hostname = "pavlovteam.ru"

# HTTP listener для JMAP (без TLS)
# Примечание: Stalwart v0.15 требует OAuth для JMAP, Basic Auth не поддерживается
[server.listener."http"]
bind = ["0.0.0.0:8080"]
protocol = "http"

# SMTP конфигурация
[server.listener."smtp"]
bind = ["0.0.0.0:25"]
protocol = "smtp"

[server.listener."submission"]
bind = ["0.0.0.0:587"]
protocol = "smtp"
starttls = "disabled"
auth = ["plain", "login"]
require-auth = true
relay = ["authenticated"]

# IMAP конфигурация
[server.listener."imap"]
bind = ["0.0.0.0:143"]
protocol = "imap"
starttls = "optional"

[server.listener."imaptls"]
bind = ["0.0.0.0:993"]
protocol = "imap"
tls.implicit = true

# Хранилище (storage)
[storage]
data = "rocksdb"
fts = "rocksdb"
blob = "rocksdb"
lookup = "rocksdb"
directory = "internal"

# Store для базы данных
[store."rocksdb"]
type = "rocksdb"
path = "/var/lib/stalwart/data/"
compression = "lz4"

# Директория пользователей (internal backend)
[directory."internal"]
type = "internal"
store = "rocksdb"

# Fallback admin (аварийный админ для первого входа)
# ВНИМАНИЕ: В production используйте bcrypt хеш пароля!
# Для генерации хеша используйте: stalwart hash --password "your_password"
# Используйте plain только для тестирования в development
# [authentication.fallback-admin]
# user = "admin"
# secret = "bcrypt:$2b$10$..."  # Замените на bcrypt хеш вашего пароля

# Обычные пользователи (создаются через веб-интерфейс или добавляются здесь)
# ВНИМАНИЕ: В production используйте bcrypt хеши паролей!
# Пример:
# [[directory."internal".users]]
# name = "admin@example.com"
# secret = "bcrypt:$2b$10$..."  # Замените на bcrypt хеш
# superuser = true
# Логирование
[tracer."stdout"]
type = "stdout"
level = "warn"
ansi = false
enable = true
